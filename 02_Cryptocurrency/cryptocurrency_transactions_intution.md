## **Cryptocurrency Transactions**


#### **Transactions and UTXOs**
Let's imagine we have some transactions, that is few people had given us some money (or coins in this case Bitcoins - BTC).
    - P1 : Me   0.1 BTC
    - P2 : Me   0.3 BTC
    - P3 : Me   0.6 BTC
    - P4 : Me   0.7 BTC
These transacted values that are the value (or moeny) transferred to me is called UTXOs (Unspent Transaction Outputs) in the world of
Bitcoin. Now, suppose we have to purchase a bicycle from a seller at a price of 0.5 BTC, then firstly we need to understand the working
of Bitcoin transaction that are way different than from the normal banking transactions.
In banking world, once you set a transaction the mentioned changes occur and the transaction is considered to be done and get's
recorded somewhere in the database, while in the world of cryptocurrency the transaction lives on even after it's being executed until
a new transaction builds.
Now, coming back to the bicycle purchasing situation using Bitcoin, we have the above mentioned UTXOs. So, what we can do to purchase
the bicycle is to set up a new transaction. In the setting up of a transaction, we need some input transactions (UTXOs) to be linked
which will accounts for the BTC I am giving in order to purchase. In this case, the price of the bicycle is 0.5 BTC so the closest
transaction that I need to link in the input is the one done by P3. Now, since the input contains 0.6 BTC and in the output we have
a bicycle of 0.5 BTC, so we left with 0.1 BTC unused, which is not allowed in the world of cryptocurrency (since the input and output
credits should be similar), then what we need to do is to transfer that remaining 0.1 BTC to Me. So, the new UTXOs will be:
    - P1 : Me   0.1 BTC
    - P2 : Me   0.3 BTC
    - P4 : Me   0.7 BTC
    - Me : Me   0.1 BTC

    
#### **Where do transaction fees come from?**
Now, suppose we have to buy another bicycle of price 0.9 BTC and an apple of price 0.02 BTC. Then what we can choose in our transaction
as input is - P2 and P4 transactions which adds upto 1 BTC and then we have in the output, the three statements - 0.9 BTC for bicycle
0.02 BTC to the fruit shop and 0.06 BTC to myself and the amount that is left accounts as the fees (i.e., 0.02 BTC in this case) which
is not at all necessary, but as we know, if we don't want our block to be stucked and gets reverted back we need some fees to be
delivered. So, the new UTXOs are:
    - P1 : Me   0.1 BTC
    - Me : Me   0.1 BTC
    - Me : Me   0.06 BTC


#### **How Wallets Work?**
Now as we know in real, we don't have nay balance what we have are UTXOs. So, what happens when we open our wallet, from where does
that amount came from. What `Wallet` actually does is that it calculates your UTXOs and tells you the amount that you can spend or
transact further. How this happens is, whenever inside a block having various transaction, we use one of the transactions we flag it,
so that when the wallet comes for counting the spendable money from each transaction in each blocks it gets to know that which
transaction is to include at which not. The transactions it will gonna be include will be the ones that are not flaged and are send
to Me (or you can say the user).


#### **Signatures: Private and Public Keys**
Now from the above example, we got to think about the privacy as anyone is able to see in the above exmaples that who is sending
money to whom. So, anyone can send the money on behalf of any other person as a transaction and submit it to the miner and once
the miner mines the block that person will losse it's money. But that's should not be the case. So, the way cryptocurrency ensures
privacy is using a `Private Key` and a `Public Key`. Private Key is the Key which is similar to your password and should not be
shared with anybody. Then there is the Public Key which is generated by the Private Key and can be shared with the others with the
help of which they will send you the money.
Now suppose we have some message to send. Then instead of directly entering it as your transaction in the block we can use the 
private key to sign the message. The private key combined with the message will generate a `signature`. Since, only I know the
private key, then the signature obtained will be unique to me and so this message will always goes with the signature. So, anybody
who encounters this message will also encouter the message. But the only question we have left now is that, how can the receiver 
will verify that indeed it was you who signed this signature. That's where the public key comes in action. In block chains there is
a verification function in the algorithm where anybody who has the message, signature and the public key when put these components
into the verification function will gives the output as Yes or No. So, this signature with message will let nodes and the minors and
everybody on the network know that the send message is send by the authorized person or not.

 
#### **What is Segregated Witness? (SegWit)**
Since we have to set the size of the block optimum. Not to larger or we can have the problem of sending it thorught the network and
not too small as we will not be able to hold the minimum number of transactions in it. So, the size of the block is choosen to be
1Mb. Now, in the block, we have headers (Block-index, Timestamp, Nonce), Transactions and the Prev. Hash which all helps in giving
the current Hash. Then, inside the Transactions part we have number of transactions, each of which should contain the transaction 
id, message (from, to, amount), signature and the public key. But since the public key and signature has the purpose of verification
and not the real part of the transaction and also due to their large size they constitute upto 60% of the total transaction size,
this space can be saved by using the `SegWit`. The concept behind SegWit is that, we send the public key an the signature separately
along with the transactions and not include them inside the same block which saves the size for the block.

